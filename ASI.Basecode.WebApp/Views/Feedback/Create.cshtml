@model ASI.Basecode.Data.Models.Feedback;

<h6>Provide Feedback</h6>

<form asp-controller="Feedback" asp-action="Create" method="post">
    <div class="form-group">
        <label for="TicketDropdown">Choose a Ticket:</label>
        <select id="TicketDropdown" name="UserTicketId" class="form-control" required>
            <option value="">Select Ticket </option>
            @foreach (var ticket in ViewBag.Tickets)
            {
                <option value="@ticket.TicketId"
                        ticket-category="@ticket.CategoryName"
                        ticket-issue="@ticket.IssueDescription"
                        ticket-created="@ticket.CreateAt"
                        ticket-fixed="@ticket.LastModified"
                        ticket-agent="@ticket.AgentId"
                        ticket-assigned="@ticket.AssignedTicketId"
                        ticket-agentname="@ticket.Name">
                    Ticket ID: @ticket.TicketId - Category: @ticket.CategoryName, Issue: @ticket.IssueDescription,
                    Created: @ticket.CreateAt, Fixed: @ticket.LastModified, Agent: @ticket.Name
                </option>
            }
        </select>
    </div>

    <input type="hidden" id="AssignedTicketId" name="AssignedTicketId" />
    <input type="hidden" id="AgentId" name="AgentId" />
    <input type="hidden" id="CategoryName" name="CategoryName" />

    <div class="form-group mt-3">
        <label for="FeedbackText">Feedback</label>
        <textarea id="FeedbackText" name="FeedbackText" class="form-control" required></textarea>
    </div>

    <div class="form-group mt-3" style="text-align: left;">
        <label for="Rating">Rate the Service:</label>
        <div class="star-rating">
            @for (int i = 5; i >= 1; i--)
            {
                <input type="radio" id="star-@i" name="FeedbackRating" value="@i" required />
                <label for="star-@i" title="@i stars">&#9733;</label>
            }
        </div>
    </div>
    <input type="hidden" id="TicketId" name="TicketId" value="@Model.UserTicketId" />

    <button type="submit" class="btn btn-primary">Submit Feedback</button>
    <a href="javascript:history.back()" class="btn btn-danger">Cancel</a>
</form>

<script>
    document.getElementById('TicketDropdown').addEventListener('change', function () {
        var selectedOption = this.options[this.selectedIndex];
        var table = document.getElementById('selectedTicketTable');

        if (selectedOption.value === "") {
            table.style.display = "none";
            document.getElementById('TicketId').value = "";
            return;
        }

        table.style.display = "table";
        document.getElementById('ticketId').innerText = selectedOption.value;
        document.getElementById('ticketCategory').innerText = selectedOption.getAttribute('data-category');
        document.getElementById('ticketIssue').innerText = selectedOption.getAttribute('data-issue');
        var attachmentPath = selectedOption.getAttribute('data-attachment');
        document.getElementById('ticketAttachment').innerHTML = attachmentPath ? `<img src="${attachmentPath}" class="w-120-px h-120-px" />` : "No file attached";
        document.getElementById('ticketCreatedAt').innerText = selectedOption.getAttribute('data-created');
        document.getElementById('ticketModifiedAt').innerText = selectedOption.getAttribute('data-modified');
        document.getElementById('TicketId').value = selectedOption.value;
    });

    document.querySelector("form").onsubmit = function () {
        document.getElementById('selectedTicketTable').style.display = "none";
        document.getElementById("TicketDropdown").selectedIndex = 0;
    };
    document.getElementById('TicketDropdown').addEventListener('change', function () {
        var selectedOption = this.options[this.selectedIndex];

        document.getElementById('AssignedTicketId').value = selectedOption.getAttribute('ticket-assigned');
        document.getElementById('AgentId').value = selectedOption.getAttribute('ticket-agent');
        document.getElementById('CategoryName').value = selectedOption.getAttribute('ticket-category');
    });
</script>

<style>
    .star-rating {
        direction: ltr;
        direction: rtl;
        font-size: 1.5em;
    }

        .star-rating input {
            display: none;
        }

        .star-rating label {
            color: #ccc;
            cursor: pointer;
        }

            .star-rating input:checked ~ label,
            .star-rating label:hover,
            .star-rating label:hover ~ label {
                color: #f90;
            }

        .star-rating label:hover ~ label {
            color: #fc0;
        }            
</style>